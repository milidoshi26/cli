using Microsoft.Security.CredScan.KnowledgeBase.Client;
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Threading.Tasks;

namespace CredScanSrc
{
    public class LocalMethods
    {
        public async Task<object> Invoke(string msg)
        {
            IEnumerable<CredScanResult> results = null;
            var scanner = new ClientCredentialScanner("FullTextProvider");
            Action<string> scanAction = delegate (string contentToScan)
            {
                results = scanner.Scan(contentToScan);
            };

            scanAction(msg);
            foreach (var credScanResult in results)
            {
                string match = credScanResult.Match.MatchValue;
                msg = msg.Replace(match, "REDACTED_CREDENTIALS");
            }
            return msg;
        }
    }
}
